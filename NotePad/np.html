<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi-Tab Notepad ‚Äî Avro Bengali</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f7f8fb;color:#222}
    header{background:linear-gradient(135deg,#4a90e2,#0078d7);color:#fff;padding:16px 20px;box-shadow:0 2px 8px rgba(0,0,0,.08);text-align:center}
    header .title{font-size:1.4rem;font-weight:700}
    header .meta{margin-top:4px;opacity:.95}
    .container{max-width:900px;margin:18px auto;background:#fff;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:18px}
    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
    .tab{padding:8px 12px;border:1px solid #dcdfe6;background:#f3f5f9;border-radius:8px 8px 0 0;cursor:pointer}
    .tab.active{background:#fff;font-weight:600;border-bottom-color:#fff}
    textarea{width:90%;min-height:320px;padding:10px 12px;border:1px solid #dcdfe6;border-radius:10px;resize:vertical;font-size:16px;line-height:1.6}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:14px}
    .btn{background:#4a90e2;border:none;color:#fff;padding:8px 14px;border-radius:8px;cursor:pointer;font-size:14px}
    .btn:hover{background:#0078d7}
    
    #emojiPicker{display:none;margin-top:10px;padding:8px;border:1px solid #ccc;border-radius:8px;background:#fafafa;font-size:22px;line-height:2;cursor:pointer}
    #emojiPicker span{margin:4px;cursor:pointer;display:inline-block;transition:transform 0.1s ease-in-out}
    #emojiPicker span:hover{transform:scale(1.3)}
  </style>
</head>
<body>
  <header>
    <div class="title">üìù Multi-Tab Notepad</div>
    <div class="meta"><span id="date"></span></div>
  </header>

  <div class="container">
    <div class="tabs" id="tabContainer"></div>
    <textarea id="noteArea" placeholder="Start typing.‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ .. ( Click ‡¶≤‡¶ø‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ : toggle)"></textarea>

    <div class="controls">
      <button class="btn" onclick="newTab()">‚ûï New Tab</button>
      <button class="btn" onclick="renameTab()">‚úèÔ∏è Rename Tab</button>
      <button class="btn" onclick="saveToFile()">üíæ Save to File</button>     
      <button class="btn" onclick="shareSelectedText()">üîó Share Selected</button>
      <button class="btn" onclick="toggleEmojiPicker()">üòä Emoji</button>
	  <button class="btn" onclick="toggleGoogleInput()">‚úçÔ∏è ‡¶≤‡¶ø‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ (Transliteration)</button>

    </div>
	
	<div id="googleInputContainer" style="display:none; margin-top:10px;">
	  <div style="width:100%; height:229px; overflow:hidden; border:1px solid #ccc;">
		<iframe src="https://www.google.com/intl/bn/inputtools/try/"
				style="width:100%; height:1000px; margin-top:-240px; border:none;">
		</iframe>
	  </div>
	</div>


    <div id="emojiPicker"></div>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Avro plugin (desktop) -->
  <script src="js/avro-v1.1.4.min.js"></script>
  <script>
  // ---------- Tabs ----------
  let tabs = JSON.parse(localStorage.getItem('notepadTabs')) || [
    { name: 'Tab 1', content: '' },
    { name: 'Tab 2', content: '' },
    { name: 'Tab 3', content: '' }
  ];
  let currentTab = 0;

  function saveTabs() {
    localStorage.setItem('notepadTabs', JSON.stringify(tabs));
  }

  function renderTabs() {
    const container = document.getElementById('tabContainer');
    container.innerHTML = '';
    tabs.forEach((tab, i) => {
      const el = document.createElement('div');
      el.className = 'tab' + (i === currentTab ? ' active' : '');
      el.innerHTML = `${tab.name} <button onclick="deleteTab(${i});event.stopPropagation();">&times;</button>`;
      el.onclick = () => switchTab(i);
      container.appendChild(el);
    });
    document.getElementById('noteArea').value = tabs[currentTab]?.content || '';
  }

  function switchTab(i) {
    saveCurrent();
    currentTab = i;
    renderTabs();
  }

  function saveCurrent() {
    if (tabs[currentTab]) {
      tabs[currentTab].content = document.getElementById('noteArea').value;
      saveTabs();
    }
  }

  function newTab() {
    saveCurrent();
    const name = prompt("Enter new tab name:", `Tab ${tabs.length + 1}`);
    if (name) {
      tabs.push({ name, content: '' });
      currentTab = tabs.length - 1;
      saveTabs();
      renderTabs();
    }
  }

  function renameTab() {
    const name = prompt("Enter new tab name:", tabs[currentTab].name);
    if (name) {
      tabs[currentTab].name = name;
      saveTabs();
      renderTabs();
    }
  }

  function deleteTab(i) {
    if (i < 0 || i >= tabs.length) return;
    const tabName = tabs[i].name;
    const msg = `‚ö†Ô∏è Are you sure you want to delete:\n\n"${tabName}" ?\n\nThis cannot be undone.`;
    if (confirm(msg)) {
      tabs.splice(i, 1);
      if (currentTab >= tabs.length) currentTab = tabs.length - 1;
      saveTabs();
      renderTabs();
    }
  }

  function saveToFile() {
    saveCurrent();
    const content = tabs.map(t => `--- ${t.name} ---\n${t.content}`).join("\n\n");
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'notepad_tabs.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ---------- Emoji Picker ----------
  function toggleEmojiPicker() {
    const picker = document.getElementById("emojiPicker");
    picker.style.display = (picker.style.display === "none" || picker.style.display === "") ? "block" : "none";

    if (picker.innerHTML === "") {
      const emojis = ["üòÄ","üòÇ","üòç","üôè","üéâ","üò¢","üò°","üëç","üëé","‚ù§Ô∏è","üî•","üåü","‚ú®","üé∂","üìö","‚úçÔ∏è","üöÄ"];
      emojis.forEach(e => {
        const span = document.createElement("span");
        span.textContent = e;
        span.onclick = () => insertEmoji(e);
        picker.appendChild(span);
      });
    }
  }

  function insertEmoji(e) {
    const area = document.getElementById("noteArea");
    const start = area.selectionStart;
    const end = area.selectionEnd;
    area.value = area.value.slice(0, start) + e + area.value.slice(end);
    area.selectionStart = area.selectionEnd = start + e.length;
    area.focus();
    if (tabs[currentTab]) {
      tabs[currentTab].content = area.value;
      saveTabs();
    }
  }

  // ---------- Date ----------
  function updateDate() {
    const now = new Date();
    const dd = String(now.getDate()).padStart(2, '0');
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const yy = String(now.getFullYear()).slice(-2);
    const time = now.toLocaleTimeString();
    const day = now.toLocaleDateString('en-US', { weekday: 'short' });
    document.getElementById('date').textContent = `${day}, ${dd}-${mm}-${yy} ${time}`;
  }
  setInterval(updateDate, 1000); updateDate();

  // ---------- UI ----------
  function toggleCheatSheet() {
    const el = document.getElementById('cheatSheet');
    el.style.display = (el.style.display===''||el.style.display==='none') ? 'block':'none';
  }

  // ---------- Avro ----------
  let avroEnabled = true;
  const isMobile = /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
  const usePlugin = !isMobile;

  document.addEventListener('DOMContentLoaded', function(){
    if (usePlugin && typeof $!=='undefined' && typeof $.fn.avro==='function') {
      $('#noteArea').avro();
    }
    enableAvroMobilePatch();
    updateAvroButton();
  });

  function toggleAvro() {
    avroEnabled = !avroEnabled;
    updateAvroButton();
    if (usePlugin && typeof $!=='undefined' && typeof $.fn.avro==='function') {
      if (avroEnabled) {
        $('#noteArea').avro();
      } else {
        $('#noteArea').unbind('.avro');
      }
    }
  }

  function updateAvroButton() {
    document.getElementById('avroToggle').textContent = avroEnabled ? 'üÖ±Ô∏è Bengali ON' : 'üî§ English ON';
  }

  function enableAvroMobilePatch() {
    const area = document.getElementById('noteArea');
    if (!area || usePlugin || area.dataset.avroPatched === '1') return;

    function convertLastAsciiWord(str) {
      const m = str.match(/([A-Za-z']+)(\s*)$/);
      if (!m) return str;
      const word = m[1], trail = m[2];
      const start = str.length - (word.length + trail.length);
      const converted = (typeof Avro !== 'undefined' && Avro.Phonetic && Avro.Phonetic.parse)
        ? Avro.Phonetic.parse(word) : word;
      return str.slice(0, start) + converted + trail;
    }

    function handleTransliteration() {
      if (!avroEnabled) return;
      const pos = area.selectionStart;
      const val = area.value;
      const before = val.slice(0, pos);
      const after = val.slice(pos);
      const lastChar = before.slice(-1);
      if (lastChar === ' ' || lastChar === '\n') {
        const newBefore = convertLastAsciiWord(before);
        if (newBefore !== before) {
          area.value = newBefore + after;
          const newPos = newBefore.length;
          area.selectionStart = area.selectionEnd = newPos;
        }
      }
    }

    area.addEventListener('input', handleTransliteration);
    area.addEventListener('compositionend', handleTransliteration);
    area.dataset.avroPatched = '1';
  }

  // ---------- Share ----------
  function shareSelectedText() {
    const area = document.getElementById('noteArea');
    const sel = area.value.substring(area.selectionStart, area.selectionEnd);
    if (!sel) { alert("Please select some text first."); return; }
    if (navigator.share) {
      navigator.share({title: 'Shared from Multi-Tab Notepad', text: sel})
        .catch(err => console.error("Error sharing: ", err));
    } else {
      alert("Sharing not supported in this browser. Please copy instead.");
    }
  }
  
  function toggleGoogleInput() {
	  const box = document.getElementById("googleInputContainer");
	  if (box.style.display === "none" || box.style.display === "") {
		box.style.display = "block";
	  } else {
		box.style.display = "none";
	  }
	}


  // ---------- Init ----------
  window.addEventListener('beforeunload', saveCurrent);
  document.getElementById('noteArea').addEventListener('input', saveCurrent);
  renderTabs();
  </script>
 
  
</body>
</html>


