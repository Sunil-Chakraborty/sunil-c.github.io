<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi-Tab Notepad ‚Äî Avro Bengali</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f7f8fb;color:#222}
    header{background:linear-gradient(135deg,#4a90e2,#0078d7);color:#fff;padding:16px 20px;box-shadow:0 2px 8px rgba(0,0,0,.08);text-align:center}
    header .title{font-size:1.4rem;font-weight:700}
    header .meta{margin-top:4px;opacity:.95}
    .container{max-width:960px;margin:18px auto;background:#fff;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:18px}
    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
    .tab{padding:8px 12px;border:1px solid #dcdfe6;background:#f3f5f9;border-radius:8px 8px 0 0;cursor:pointer}
    .tab.active{background:#fff;font-weight:600;border-bottom-color:#fff}
    textarea{width:100%;min-height:320px;padding:10px 12px;border:1px solid #dcdfe6;border-radius:10px;resize:vertical;font-size:16px;line-height:1.6}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:14px}
    .btn{background:#4a90e2;border:none;color:#fff;padding:8px 14px;border-radius:8px;cursor:pointer;font-size:14px}
    .btn:hover{background:#0078d7}
    #cheatSheet{display:none;margin-top:14px;height:70vh;border:1px solid #e5e7eb;border-radius:10px;overflow:auto}
    #cheatSheet img{width:100%;height:auto;display:block;margin:auto}
    #emojiPicker{display:none;margin-top:10px;padding:8px;border:1px solid #ccc;border-radius:8px;background:#fafafa;font-size:22px;line-height:2;cursor:pointer}
    #emojiPicker span{margin:4px;cursor:pointer;display:inline-block;transition:transform 0.1s}
    #emojiPicker span:hover{transform:scale(1.3)}
  </style>
</head>
<body>
  <header>
    <div class="title">üìù Multi-Tab Notepad</div>
    <div class="meta"><span id="date"></span></div>
  </header>

  <div class="container">
    <div class="tabs" id="tabContainer"></div>
    <textarea id="noteArea" placeholder="Start typing... (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ: Avro ON / English: toggle)"></textarea>

    <div class="controls">
      <button class="btn" onclick="newTab()">‚ûï New Tab</button>
      <button class="btn" onclick="renameTab()">‚úèÔ∏è Rename Tab</button>
      <button class="btn" onclick="saveToFile()">üíæ Save to File</button>
      <button class="btn" id="avroToggle" onclick="toggleAvro()">üÖ±Ô∏è Bengali ON</button>
      <button class="btn" onclick="shareSelectedText()">Share Selected Text</button>
      <button class="btn" onclick="toggleCheatSheet()">üìñ Cheat Sheet (JPG)</button>
      <button class="btn" onclick="toggleEmojiPicker()">üòä Emoji</button>
    </div>

    <div id="cheatSheet">
      <img src="cheatSheet.jpg" alt="ImageMagick Cheat Sheet">
    </div>
    <div id="emojiPicker"></div>
  </div>

  <!-- jQuery + Avro -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js/avro-v1.1.4.min.js"></script>

  <script>
    // -------- Tabs --------
    let tabs = JSON.parse(localStorage.getItem('notepadTabs')) || [
      { name: 'Tab 1', content: '' },
      { name: 'Tab 2', content: '' },
      { name: 'Tab 3', content: '' }
    ];
    let currentTab = 0;

    function saveTabs() {
      localStorage.setItem('notepadTabs', JSON.stringify(tabs));
    }

    function renderTabs() {
      const container = document.getElementById('tabContainer');
      container.innerHTML = '';
      tabs.forEach((tab, i) => {
        const el = document.createElement('div');
        el.className = 'tab' + (i === currentTab ? ' active' : '');
        el.innerHTML = `${tab.name} <button onclick="deleteTab(${i});event.stopPropagation();">&times;</button>`;
        el.onclick = () => switchTab(i);
        container.appendChild(el);
      });
      document.getElementById('noteArea').value = tabs[currentTab]?.content || '';
    }

    function switchTab(i) {
      saveCurrent();
      currentTab = i;
      renderTabs();
    }

    function saveCurrent() {
      if (tabs[currentTab]) {
        tabs[currentTab].content = document.getElementById('noteArea').value;
        saveTabs();
      }
    }

    function newTab() {
      saveCurrent();
      const name = prompt("Enter new tab name:", `Tab ${tabs.length + 1}`);
      if (name) {
        tabs.push({ name, content: '' });
        currentTab = tabs.length - 1;
        saveTabs();
        renderTabs();
      }
    }

    function renameTab() {
      const name = prompt("Rename tab:", tabs[currentTab].name);
      if (name) {
        tabs[currentTab].name = name;
        saveTabs();
        renderTabs();
      }
    }

    function deleteTab(i) {
	  if (i < 0 || i >= tabs.length) return;

	  const tabName = tabs[i].name;
	  const confirmMsg = `‚ö†Ô∏è Are you sure you want to delete the tab:\n\n"${tabName}" ?\n\nThis action cannot be undone.`;

	  if (confirm(confirmMsg)) {
		tabs.splice(i, 1);
		if (currentTab >= tabs.length) currentTab = tabs.length - 1;
		saveTabs();
		renderTabs();
	  }
	}
	
    function saveToFile() {
      saveCurrent();
      const content = tabs.map(t => `--- ${t.name} ---\n${t.content}`).join("\n\n");
      const blob = new Blob([content], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'notepad_tabs.txt';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    // -------- Emoji --------
    function toggleEmojiPicker() {
      const picker = document.getElementById('emojiPicker');
      picker.style.display = picker.style.display === "none" || picker.style.display === "" ? "block" : "none";
      if (picker.innerHTML === "") {
        const emojis = ["üòÄ","üòÇ","üòç","üôè","üéâ","üò¢","üò°","üëç","üëé","‚ù§Ô∏è","üî•","üåü","‚ú®","üé∂","üìö","‚úçÔ∏è","üöÄ"];
        emojis.forEach(e => {
          const span = document.createElement("span");
          span.textContent = e;
          span.onclick = () => insertEmoji(e);
          picker.appendChild(span);
        });
      }
    }

    function insertEmoji(e) {
      const ta = document.getElementById("noteArea");
      const start = ta.selectionStart, end = ta.selectionEnd;
      ta.value = ta.value.slice(0, start) + e + ta.value.slice(end);
      ta.selectionStart = ta.selectionEnd = start + e.length;
      ta.focus();
      tabs[currentTab].content = ta.value; // ‚úÖ update correct tab
      saveTabs();
    }

    // -------- Cheat Sheet --------
    function toggleCheatSheet() {
      const el = document.getElementById('cheatSheet');
      el.style.display = el.style.display === "none" || el.style.display === "" ? "block" : "none";
    }

    // -------- Share --------
    function shareSelectedText() {
      const ta = document.getElementById('noteArea');
      const sel = ta.value.substring(ta.selectionStart, ta.selectionEnd);
      if (!sel) return alert("Please select some text first.");
      if (navigator.share) {
        navigator.share({ title: 'Shared from Notepad', text: sel });
      } else {
        alert("Sharing not supported in this browser.");
      }
    }

    // -------- Avro --------
    const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    let avroEnabled = true;
    function toggleAvro() {
      avroEnabled = !avroEnabled;
      document.getElementById('avroToggle').textContent = avroEnabled ? 'üÖ±Ô∏è Bengali ON' : 'üî§ English ON';
      if (avroEnabled && !isMobile) $('#noteArea').avro();
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (!isMobile && avroEnabled && typeof $.fn.avro === 'function') $('#noteArea').avro();
    });

    // -------- Date --------
    function updateDate() {
      const now = new Date();
      const dd = String(now.getDate()).padStart(2,'0');
      const mm = String(now.getMonth()+1).padStart(2,'0');
      const yy = String(now.getFullYear()).slice(-2);
      const time = now.toLocaleTimeString();
      const day = now.toLocaleDateString('en-US',{weekday:'short'});
      document.getElementById('date').textContent = `${day}, ${dd}-${mm}-${yy} ${time}`;
    }
    setInterval(updateDate,1000);
    updateDate();

    // -------- Init --------
    document.getElementById('noteArea').addEventListener('input', saveCurrent);
    window.addEventListener('beforeunload', saveCurrent);
    renderTabs();
  </script>
</body>
</html>
